---
title: "EDA"
author: "Jae Yeon Kim"
date: "`r Sys.Date()`"
output: html_document
---

# Install pkgs and load data 

```{r}

if (!require(pacman)) install.packages("pacman")

pacman::p_load(glue, 
               here, 
               tidyverse,
               readxl,
               xlsx,
               estimatr, 
               remotes,
               modelsummary,
               naniar)

install_github("vincentarelbundock/tinytable")
library(tinytable)

devtools::install_github("graemeblair/stdidx")
library(stdidx)

df <- read_xlsx(here("raw_data", "Stress+Testing+Black-Latino+Coalition_December+8,+2023_18.48.xlsx"))[-c(1:2),]
```

# Data quality check 

```{r}
df <- df %>%
  mutate(Condition = paste(Control_Turtle, SharedDisc, Incommensurate)) 

2602/nrow(df) # 94% are black participants 

df %>%
  filter(Race == "2") %>%
  group_by(Condition) %>%
  summarize(N = n()) %>%
  mutate(Condition = c(
    "Control + T2",
    "Control",
    "T1 + T2",
    "T1",
    "No condition")
    ) %>%
  tt()
```

# ATE estimation

1) exposure to shared discrimination increases Black solidarity with other people of color; 
2) an additional unit shift in solidarity increases Black support for pro-Latino policies; and,
3) exposure to the distinctiveness manipulation (which was meant to reduce solidarity) decreases Black solidarity with other people of color, although this decline is small and statistically insignificant. 

## Black solidarity with PoC

```{r}
df <- df %>%
  mutate(sol_index = (as.numeric(Solidarity_Bond) + as.numeric(Solidarity_Allies) + as.numeric(Solidariy_CFate))/3, 
         latino_support_index = (as.numeric(Latino_1) + as.numeric(Latino_2R) + as.numeric(Latino_3) + as.numeric(Latino_4))/4)

df %>%
  filter(Race == "2") %>%
  filter(Condition != "NA NA NA") %>%
  group_by(Condition) %>%
  summarize(sol_est = mean(sol_index, na.rm = T), 
            ls_est = mean(latino_support_index, na.rm = T),
            sol_se = sd(sol_index, na.rm = TRUE) / sqrt(n()),
            ls_se = sd(latino_support_index, na.rm = TRUE) / sqrt(n())
  ) %>%
  mutate(Condition = c(
    "Control + T2",
    "Control",
    "T1 + T2",
    "T1"))
```
